language: php

dist: trusty

sudo: true

php:
#  - 5.5
  - 5.6
  - 7.0
  - 7.1
  - hhvm

env:
  - DB=mysql
  - DB=sqlite

services:
  - mysql

mysql:
  database: test_fc
  username: root
  encoding: utf8  
  
matrix:
  fast_finish: true
#
#  include:
#    - php: 7.0
#      env: PHPCS=1

addons:
    code_climate:
        repo_token: 0b3e8b1e905bbea0d9d991090bf84a74404b256065bac4216a89890741416b31


before_script:
  - composer selfupdate
  - composer install --prefer-dist --no-suggest --no-interaction
  - cp ./.travis_app_local_mysql.txt ./config/app_local.php
  - php bin/cake.php migrations migrate
#  - if [[ $PHPCS = 1 ]]; then composer require cakephp/cakephp-codesniffer:~2.1; fi
#  - if [[ $PHPCS != 1 ]]; then composer install; fi
#  - if [[ $PHPCS != 1 ]]; then composer run-script post-install-cmd --no-interaction; fi

before_install:
  - mysql -e 'CREATE DATABASE IF NOT EXISTS test_fc;'

script:
  - vendor/bin/phpunit --coverage-clover=coverage.xml
#  - if [[ $PHPCS != 1 ]]; then phpunit; fi
#  - if [[ $PHPCS = 1 ]]; then vendor/bin/phpcs -p --extensions=php --standard=vendor/cakephp/cakephp-codesniffer/CakePHP ./src ./tests ./config ./webroot; fi

after_success:
    - bash <(curl -s https://codecov.io/bash)

cache:
  directories:
    - $HOME/.composer/cache

notifications:
  email: false
